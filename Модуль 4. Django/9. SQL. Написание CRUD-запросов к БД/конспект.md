# Урок 9. SQL. Написание CRUD-запросов к БД

### Методический материал: Использование Django ORM и SQL для CRUD-операций

#### Введение

CRUD (Create, Read, Update, Delete) — это основные операции, которые выполняются с базой данных. В Django для выполнения этих операций можно использовать как Django ORM, так и прямые SQL-запросы. В этом методическом материале рассмотрим, когда и почему использовать каждый из этих подходов, а также их преимущества и недостатки.

#### 1. Использование Django ORM

**Когда использовать:**
- Простые и стандартные операции с базой данных.
- Необходимость абстракции базы данных для работы с различными СУБД.
- Автоматическое управление миграциями.
- Обеспечение безопасности от SQL-инъекций.
- Упрощенная работа с отношениями между моделями.

**Преимущества:**
- Простота и удобство использования.
- Абстракция базы данных.
- Автоматическое управление миграциями.
- Безопасность от SQL-инъекций.
- Упрощенная работа с отношениями между моделями.

**Недостатки:**
- Может быть менее производительным для сложных запросов.
- Ограниченные возможности для использования специфических функций базы данных.
- Может быть сложно отлаживать сложные запросы.

**Примеры:**

1. **Создание новой записи:**
   ```python
   from news.models import Category

   new_category = Category.objects.create(name='Новая категория')
   ```

2. **Выборка данных:**
   ```python
   from news.models import Article, Category

   category = Category.objects.get(name='Технологии')
   articles = Article.objects.filter(category=category)
   ```

3. **Обновление записи:**
   ```python
   from news.models import Article

   Article.objects.filter(id=4).update(title='Обновленный заголовок')
   ```

4. **Удаление записи:**
   ```python
   from news.models import Article, Tag

   article = Article.objects.get(id=6)
   article.tags.clear()  # Удаление всех связанных тегов
   article.delete()  # Удаление статьи
   ```

#### 2. Использование SQL

**Когда использовать:**
- Сложные и оптимизированные запросы.
- Необходимость использования специфических функций базы данных.
- Отладка и анализ запросов.
- Повышение производительности для сложных запросов.

**Преимущества:**
- Большая гибкость и контроль над запросами.
- Возможность использования специфических функций базы данных.
- Легкость отладки и анализа запросов.
- Потенциально более высокая производительность для сложных запросов.

**Недостатки:**
- Более сложный и менее читаемый код.
- Требует больше усилий для обеспечения безопасности от SQL-инъекций.
- Меньшая абстракция базы данных, что может усложнить переход на другую базу данных.
- Требует ручного управления миграциями.

**Примеры:**

1. **Создание новой записи:**
   ```sql
   INSERT INTO news_category (name) VALUES ('Новая категория');
   ```

2. **Выборка данных:**
   ```sql
   SELECT * FROM news_article WHERE category_id = (SELECT id FROM news_category WHERE name = 'Технологии');
   ```

3. **Обновление записи:**
   ```sql
   UPDATE news_article SET title = 'Обновленный заголовок' WHERE id = 4;
   ```

4. **Удаление записи:**
   ```sql
   DELETE FROM news_article_tags WHERE article_id = 6;
   DELETE FROM news_article WHERE id = 6;
   ```

#### Заключение

Выбор между Django ORM и SQL зависит от конкретных требований вашего проекта. Django ORM предоставляет удобство и безопасность для большинства стандартных операций, тогда как SQL дает большую гибкость и контроль для сложных и оптимизированных запросов. В идеале, можно использовать оба подхода в зависимости от контекста: Django ORM для стандартных операций и SQL для сложных и оптимизированных запросов.