**–í—Ç–æ—Ä–æ–π —É—Ä–æ–∫: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ä–∞–±–æ—Ç–∞ —Å SQLAlchemy –≤ FastAPI**

# –í–≤–µ–¥–µ–Ω–∏–µ

–í–æ –≤—Ç–æ—Ä–æ–º —É—Ä–æ–∫–µ –º—ã —É–≥–ª—É–±–∏–º—Å—è –≤ —Ä–∞–±–æ—Ç—É —Å SQLAlchemy –≤ FastAPI. –ú—ã —Ä–∞–∑–±–µ—Ä–µ–º –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ `Depends()`, —Å–ª–æ–∂–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏, –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON-—Ñ–∞–π–ª–∞, –∞–≥—Ä–µ–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è. –í –∫–æ–Ω—Ü–µ —É—Ä–æ–∫–∞ —É –Ω–∞—Å –±—É–¥—É—Ç –≥–æ—Ç–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–≤—Ç–æ—Ä–∞–º–∏ –∏ —Ç–µ–≥–∞–º–∏ –∫–Ω–∏–≥.

---

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Depends()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏

#### –ü–æ—á–µ–º—É `Depends()` —É–¥–æ–±–µ–Ω –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

FastAPI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (`Depends()`), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤. –≠—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏ SQLAlchemy, —Ç–∞–∫ –∫–∞–∫ –º—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å–µ—Å—Å–∏—é –≤ –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é API –±–µ–∑ —è–≤–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏

```python
from fastapi import Depends
from sqlalchemy.orm import Session
from database import SessionLocal

def get_db():
    """–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –µ—ë –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è."""
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

–¢–µ–ø–µ—Ä—å –≤ –∫–∞–∂–¥–æ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ –º—ã –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ–º `db: Session = Depends(get_db)`, –∏ FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞—Å—Ç –æ–±—ä–µ–∫—Ç —Å–µ—Å—Å–∏–∏.

---

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü `Author` –∏ `Tag`

#### –†–∞–∑–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–Ω—è—Ç–∏–π

- **`book_tag_association`** ‚Äì —Ç–∞–±–ª–∏—Ü–∞-–ø–æ—Å—Ä–µ–¥–Ω–∏–∫, —Å–≤—è–∑—ã–≤–∞—é—â–∞—è –∫–Ω–∏–≥–∏ –∏ —Ç–µ–≥–∏ (`M:N`).
- **`Base.metadata`** ‚Äì —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö –º–æ–¥–µ–ª—è—Ö SQLAlchemy, —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ö–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- **`ForeignKey()`** ‚Äì –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á, —Å–≤—è–∑—ã–≤–∞—é—â–∏–π –æ–¥–Ω—É —Ç–∞–±–ª–∏—Ü—É —Å –¥—Ä—É–≥–æ–π.
- **`back_populates`** ‚Äì –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–≤—è–∑—å –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –ø–æ–ª—É—á–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏.
- **`secondary`** ‚Äì –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ `relationship()`, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¥–ª—è `M:N`.
- **`relationship()`** ‚Äì —Å–æ–∑–¥–∞—ë—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏, —É–ø—Ä–æ—â–∞—è –¥–æ—Å—Ç—É–ø –∫ —Å–≤—è–∑–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º.

#### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
```python
from sqlalchemy import Column, Integer, String, ForeignKey, Table
from sqlalchemy.orm import relationship
from database import Base

# –ê—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Å–≤—è–∑–∏ –º–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º (–∫–Ω–∏–≥–∏ - —Ç–µ–≥–∏)
book_tag_association = Table(
    "book_tag_association",
    Base.metadata,
    Column("book_id", Integer, ForeignKey("books.id")),
    Column("tag_id", Integer, ForeignKey("tags.id"))
)

class Author(Base):
    """–ú–æ–¥–µ–ª—å –∞–≤—Ç–æ—Ä–∞ –∫–Ω–∏–≥."""
    __tablename__ = "authors"
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, index=True)
    # –û–¥–∏–Ω –∞–≤—Ç–æ—Ä –º–æ–∂–µ—Ç –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–Ω–∏–≥ (1:N)
    books = relationship("Book", back_populates="author")

class Tag(Base):
    """–ú–æ–¥–µ–ª—å –∂–∞–Ω—Ä–∞ (—Ç–µ–≥–∞), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å —É –∫–Ω–∏–≥–∏."""
    __tablename__ = "tags"
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, index=True)
    # –û–¥–∏–Ω —Ç–µ–≥ –º–æ–∂–µ—Ç –±—ã—Ç—å —É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–Ω–∏–≥, —Å–≤—è–∑—å —á–µ—Ä–µ–∑ book_tag_association (M:N)
    books = relationship("Book", secondary=book_tag_association, back_populates="tags")

class Book(Base):
    """–ú–æ–¥–µ–ª—å –∫–Ω–∏–≥–∏."""
    __tablename__ = "books"
    id = Column(Integer, primary_key=True, index=True)
    title = Column(String, index=True)
    author_id = Column(Integer, ForeignKey("authors.id"))
    # –£ –∫–∞–∂–¥–æ–π –∫–Ω–∏–≥–∏ –µ—Å—Ç—å –æ–¥–∏–Ω –∞–≤—Ç–æ—Ä (N:1)
    author = relationship("Author", back_populates="books")
    # –£ –∫–∞–∂–¥–æ–π –∫–Ω–∏–≥–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ–≥–æ–≤ (M:N)
    tags = relationship("Tag", secondary=book_tag_association, back_populates="books")
```

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π Alembic
```sh
alembic revision --autogenerate -m "add authors and tags"
alembic upgrade head
```

---

### 3. –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ Alembic: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

#### –ì–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–∏?
–í—Å–µ —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `alembic/versions/`. –ö–∞–∂–¥–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
–§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:
- `revision` ‚Äì —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏.
- `down_revision` ‚Äì –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–µ–¥—ã–¥—É—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏.
- `upgrade()` ‚Äì —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏.
- `downgrade()` ‚Äì —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥ –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏.

#### –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
```python
from alembic import op
import sqlalchemy as sa
from sqlalchemy.orm import Session

def upgrade():
    """–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ—Ä–æ–≤ –∏ —Ç–µ–≥–æ–≤."""
    op.create_table(
        "authors",
        sa.Column("id", sa.Integer(), primary_key=True),
        sa.Column("name", sa.String(), nullable=False)
    )

    op.create_table(
        "tags",
        sa.Column("id", sa.Integer(), primary_key=True),
        sa.Column("name", sa.String(), nullable=False)
    )

    op.create_table(
        "books",
        sa.Column("id", sa.Integer(), primary_key=True),
        sa.Column("title", sa.String(), nullable=False),
        sa.Column("author_id", sa.Integer(), sa.ForeignKey("authors.id"), nullable=False)
    )

    op.create_table(
        "book_tag_association",
        sa.Column("book_id", sa.Integer(), sa.ForeignKey("books.id"), primary_key=True),
        sa.Column("tag_id", sa.Integer(), sa.ForeignKey("tags.id"), primary_key=True)
    )

def downgrade():
    """–û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é, —É–¥–∞–ª—è—è —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã."""
    op.drop_table("book_tag_association")
    op.drop_table("books")
    op.drop_table("tags")
    op.drop_table("authors")
```

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏**:
  ```sh
  alembic revision --autogenerate -m "add authors and tags"
  ```
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏**:
  ```sh
  alembic upgrade head
  ```
- **–û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏**:
  ```sh
  alembic downgrade -1
  ```

–¢–µ–ø–µ—Ä—å –º—ã –∑–Ω–∞–µ–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Alembic –∏ –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–º–∏!

---

### 4. –ó–∞–≥—Ä—É–∑–∫–∞ JSON-—Ñ–∞–π–ª–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∞–π–ª `books.json`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç:

- `authors` ‚Äì —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–æ–≤ —Å ID –∏ –∏–º–µ–Ω–µ–º.
- `tags` ‚Äì —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ (—Ç–µ–≥–æ–≤) —Å ID –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º.
- `books` ‚Äì —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ —Å ID, –Ω–∞–∑–≤–∞–Ω–∏–µ–º, ID –∞–≤—Ç–æ—Ä–∞ –∏ —Å–ø–∏—Å–∫–æ–º –∂–∞–Ω—Ä–æ–≤.

### 4.1 –ö—É–¥–∞ –ø–æ–º–µ—Å—Ç–∏—Ç—å JSON-—Ñ–∞–π–ª??

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª `books.json` –≤ –ø–∞–ø–∫—É `data/` –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:

```
/your_project/data/books.json
```

### 4.2 –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Alembic

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é:

```sh
alembic revision --autogenerate -m "Load books data"
```

–û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ `alembic/versions/` –∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–¥:

```python
import json
from alembic import op
import sqlalchemy as sa
from sqlalchemy.orm import Session
from models import Author, Book, Tag, book_tag_association

def upgrade():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON-—Ñ–∞–π–ª–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö."""
    bind = op.get_bind()
    session = Session(bind=bind)

    with open("data/books.json", "r") as f:
        data = json.load(f)

    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–≤—Ç–æ—Ä–æ–≤
    for author in data["authors"]:
        session.execute(sa.insert(Author).values(id=author["id"], name=author["name"]))
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–≥–∏ (–∂–∞–Ω—Ä—ã)
    for tag in data["tags"]:
        session.execute(sa.insert(Tag).values(id=tag["id"], name=tag["name"]))
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–Ω–∏–≥–∏
    for book in data["books"]:
        session.execute(sa.insert(Book).values(id=book["id"], title=book["title"], author_id=book["author_id"]))
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–≤—è–∑–∏ –∫–Ω–∏–≥ —Å —Ç–µ–≥–∞–º–∏ (–∂–∞–Ω—Ä–∞–º–∏)
    for book in data["books"]:
        for tag_id in book["tag_ids"]:
            session.execute(sa.insert(book_tag_association).values(book_id=book["id"], tag_id=tag_id))
    
    session.commit()

def downgrade():
    """–£–¥–∞–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö."""
    bind = op.get_bind()
    session = Session(bind=bind)
    session.execute("DELETE FROM book_tag_association")
    session.execute("DELETE FROM books")
    session.execute("DELETE FROM authors")
    session.execute("DELETE FROM tags")
    session.commit()
```

### 4.3 –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

```sh
alembic upgrade head
```

–¢–µ–ø–µ—Ä—å –≤—Å–µ –∞–≤—Ç–æ—Ä—ã, –∫–Ω–∏–≥–∏ –∏ –∂–∞–Ω—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!

---

## **5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤: `selectinload()` –∏ `joinedload()`**

### 5.1 –ß—Ç–æ —Ç–∞–∫–æ–µ `selectinload()` –∏ `joinedload()`?
- `selectinload()` –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–∞–Ω–∞–ª–æ–≥ `prefetch_related` –≤ Django).
- `joinedload()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `JOIN`, –∑–∞–≥—Ä—É–∂–∞—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º SQL-–∑–∞–ø—Ä–æ—Å–µ (–∞–Ω–∞–ª–æ–≥ `select_related` –≤ Django).

### 5.2 –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ SQLAlchemy
```python
from sqlalchemy.orm import selectinload, joinedload

def get_books_with_authors(db: Session):
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–Ω–∏–≥–∏ –≤–º–µ—Å—Ç–µ —Å –∞–≤—Ç–æ—Ä–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—è `selectinload()`."""
    return db.query(Book).options(selectinload(Book.author)).all()

def get_books_with_tags(db: Session):
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–Ω–∏–≥–∏ –≤–º–µ—Å—Ç–µ —Å —Ç–µ–≥–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—è `joinedload()`."""
    return db.query(Book).options(joinedload(Book.tags)).all()
```

### 5.3 –ö–∞–∫ –æ–Ω–∏ —Å–æ–æ—Ç–Ω–æ—Å—è—Ç—Å—è —Å Django ORM?
- `selectinload()` ‚âà `prefetch_related()` ‚Äì –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IN` –≤ SQL.
- `joinedload()` ‚âà `select_related()` ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `JOIN`, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º SQL-–∑–∞–ø—Ä–æ—Å–µ.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∏–∑–±–µ–≥–∞—è –ø—Ä–æ–±–ª–µ–º—ã **N+1 –∑–∞–ø—Ä–æ—Å–æ–≤**.

---

## **6. –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –µ—ë –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Swagger**

### 6.1 –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏—è?
–ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π, –ø–æ–ª—É—á–∞–µ–º—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å API.

### 6.2 –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤ SQLAlchemy?
```python
def get_paginated_books(db: Session, skip: int = 0, limit: int = 10):
    """–ü–æ–ª—É—á–∞–µ—Ç –∫–Ω–∏–≥–∏ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π."""
    return db.query(Book).offset(skip).limit(limit).all()
```
–ó–¥–µ—Å—å `skip` —É–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –∞ `limit` ‚Äì —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –≤–µ—Ä–Ω—É—Ç—å.

### 6.3 –í –∫–∞–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö –Ω—É–∂–Ω–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏—è?
–ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ–ª–µ–∑–Ω–∞ –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏—Ö –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- `/books/` ‚Äì —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–Ω–∏–≥
- `/authors/{id}/books` ‚Äì –∫–Ω–∏–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞
- `/tags/{id}/books` ‚Äì –∫–Ω–∏–≥–∏, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É —Ç–µ–≥—É

### 6.4 –ö–∞–∫ —É–≤–∏–¥–µ—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤ Swagger?
FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Swagger, –µ—Å–ª–∏ –æ–Ω–∏ –æ–±—ä—è–≤–ª–µ–Ω—ã –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ:
```python
from fastapi import APIRouter, Query

router = APIRouter()

@router.get("/books/")
def get_books(db: Session = Depends(get_db), skip: int = Query(0), limit: int = Query(10)):
    """–≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–Ω–∏–≥ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–∏."""
    return db.query(Book).offset(skip).limit(limit).all()
```
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ FastAPI API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
```
http://127.0.0.1:8000/docs
```

–¢–µ–ø–µ—Ä—å API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é, –∏ –µ—ë –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤ Swagger! üöÄ

---

## **7. –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–∏–≥–∞–º–∏, –∞–≤—Ç–æ—Ä–∞–º–∏ –∏ —Ç–µ–≥–∞–º–∏**

### 7.1 –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–æ–≤
```python
@router.get("/authors/")
def get_authors(db: Session = Depends(get_db)):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–æ–≤."""
    return db.query(Author).all()
```

### 7.2 –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–∏–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞
```python
@router.get("/authors/{author_id}/books")
def get_books_by_author(author_id: int, db: Session = Depends(get_db)):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞."""
    return db.query(Book).filter(Book.author_id == author_id).all()
```

### 7.3 –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ–≥–æ–≤
```python
@router.get("/tags/")
def get_tags(db: Session = Depends(get_db)):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ–≥–æ–≤."""
    return db.query(Tag).all()
```

### 7.4 –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–∏–≥ –ø–æ —Ç–µ–≥—É
```python
@router.get("/tags/{tag_id}/books")
def get_books_by_tag(tag_id: int, db: Session = Depends(get_db)):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥, –æ—Ç–Ω–æ—Å—è—â–∏—Ö—Å—è –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É —Ç–µ–≥—É."""
    return db.query(Book).join(book_tag_association).filter(book_tag_association.c.tag_id == tag_id).all()
```

### 7.5 –ü–æ–∏—Å–∫ –∫–Ω–∏–≥–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
```python
@router.get("/books/search/")
def search_books(keyword: str, db: Session = Depends(get_db)):
    """–ü–æ–∏—Å–∫ –∫–Ω–∏–≥ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ—á—ë—Ç–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞."""
    return db.query(Book).filter(Book.title.ilike(f"%{keyword}%")).all()
```

–¢–µ–ø–µ—Ä—å API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–∏–≥–∞–º–∏, –∞–≤—Ç–æ—Ä–∞–º–∏ –∏ —Ç–µ–≥–∞–º–∏! üöÄ



